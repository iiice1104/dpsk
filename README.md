# dpsk-R1

# 1.支持128K输入上下文长度

RoPE(Rotary Position Embedding)：旋转位置编码

外推性：模型对超出训练范围的数据的泛化性能，对于RoPE指的是处理比训练时更长的序列时的有效性

核心问题：比训练时更长的序列意味着模型需要处理未见过的位置索引
位置编码的重要性：模型通过位置编码来理解token的顺序关系，若外推性不足，模型难以捕捉长距离位置依赖或相对位置关系

如果外推性较差：则模型处理长文本生成任务时可能出现语段重复、逻辑混乱的情况

RoPE通过几何旋转将位置信息融入向量，旋转角度具有周期性，即使位置索引m超出范围，也能通过旋转将其处理到合理范围内，内积结果依赖相对位置差而不是绝对位置，从而外推性表现好(暂时不理解为什么RoPE的外推性好)

YaRN(Yet another RoPE extensioN):结合NTK(动态调整旋转角度基数)和位置插值（将位置索引m压缩成m/λ到训练范围），进一步扩展上下文窗口（模型单次处理时可以考虑的最大token数量，即捕捉信息的范围）
RoPE的外推性具有局限性，YaRN在RoPE的基础上采用多阶段插值策略和动态调整机制，具有更优的外推性，在超出长度的序列任务上表现优异

优化措施中的一些概念：
高频维度：RoPE中旋转角度较大，旋转速度较快的维度，一般是隐藏层的低维部分，索引较小，擅长捕捉局部细节和近距离依赖关系
低频维度：相应地，旋转角度较小，旋转较慢，维度索引较大，捕捉长距离依赖和全局结构
波长：设旋转角度为θi，则旋转一周是2Π，波长λ是在维度i上旋转一周（2Π）需要的序列长度。例如当λ=100，则每100个token后改维度的位置编码会循环一次
短波长（高频维度）：旋转角度大，波长短，适合编码局部位置
长波长（低频维度）：旋转角度小，波长长，适合编码全局位置

优化策略：根据波长λ与预训练长度的关系，将序列分为三个部分，较短波长即索引较小部分保留原始编码，中等波长部分插值，较长波长即索引较大部分完全插值

# 2.

